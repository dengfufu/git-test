<nz-card nzTitle="安全设置">
  <nz-list nzItemLayout="horizontal">
    <nz-list-item [nzActions]="[passwordOp]">
      <ng-template #passwordOp>
        <a (click)="modalVisible('password')" *ngIf="isExistPassword">修改</a>
        <a (click)="modalVisible('password')" *ngIf="!isExistPassword">设置</a>
      </ng-template>
      <nz-list-item-meta nzTitle="账户密码" [nzDescription]="passwordDesc">
        <ng-template #passwordDesc > <span  *ngIf="isExistPassword">已</span>
          <span  *ngIf="!isExistPassword">未</span>设置密码</ng-template>
      </nz-list-item-meta>
    </nz-list-item>
    <nz-list-item [nzActions]="[phoneOp]">
      <ng-template #phoneOp>
        <!--<a (click)="modalVisible('mobile')">修改</a>-->
      </ng-template>
      <nz-list-item-meta nzTitle="密保手机" [nzDescription]="phoneDesc">
        <ng-template #phoneDesc>已绑定手机: {{userService.userInfo.mobile}}</ng-template>
      </nz-list-item-meta>
    </nz-list-item>
  </nz-list>
</nz-card>
<!--///////-->
<nz-modal [(nzVisible)]="isChangePasswordVisible"
          nzTitle="{{title}}"
          (nzOnCancel)="handleCancel('password')"
          (nzOnOk)="handleOk('password')"
          [nzOkDisabled]="changePasswordForm.invalid"
          [nzOkLoading]="isOkLoading">
  <nz-spin [nzSpinning]="changPasswordSpinning" >
    <form nz-form  nzLayout="vertical" [formGroup]="changePasswordForm" >
      <nz-form-item *ngIf="!isExistPassword">
        <nz-form-control>
          <nz-row [nzGutter]="8">
            <nz-col [nzSpan]="16">
              <nz-input-group nzSize="large" nzAddonBeforeIcon="smsCode">
                <input nz-input formControlName="smsCode" [placeholder]="'验证码'"/>
              </nz-input-group>

            </nz-col>
            <nz-col [nzSpan]="8">
              <button
                type="button"
                nz-button
                nzSize="large"
                (click)="getCaptcha('password')"
                [disabled]="count"
                nzBlock
                [nzLoading]="isSmsLoading">
                {{ count ? count + 's' : '获取验证码' }}
              </button>
            </nz-col>
          </nz-row>
          <nz-form-explain *ngIf="smsCode.dirty && smsCode.errors">
            <ng-container *ngIf="smsCode.errors.required">请输入验证码！</ng-container>
            <ng-container *ngIf="smsCode.errors.pattern">验证码格式错误！</ng-container>
          </nz-form-explain>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item *ngIf="isExistPassword">
        <nz-form-label>旧密码</nz-form-label>
        <nz-form-control nzHasFeedback [nzErrorTip]="oldPasswordErrorTpl">
          <input nz-input formControlName="oldPassword" type="password"/>
        </nz-form-control>
        <ng-template #oldPasswordErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">
            请输入旧密码！
          </ng-container>
        </ng-template>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>新密码</nz-form-label>
        <nz-form-control nzHasFeedback [nzErrorTip]="newPasswordErrorTpl">
          <input nz-input formControlName="newPassword" type="password" placeholder="6~20位字母、数字或者特殊字符"/>
        </nz-form-control>
        <ng-template #newPasswordErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">
            请输入新密码！
          </ng-container>
          <ng-container *ngIf="control.hasError('pattern')">
            6~20位字母、数字或者特殊字符！
          </ng-container>
        </ng-template>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>确认新密码</nz-form-label>
        <nz-form-control nzHasFeedback  [nzErrorTip]="confirmErrorTpl">
          <input nz-input formControlName="confirm" type="password" placeholder="6~20位字母、数字或者特殊字符"/>
          <ng-template #confirmErrorTpl let-control>
            <ng-container *ngIf="control.hasError('match')">
              两次输入的密码不匹配！
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
    </form>
  </nz-spin>
</nz-modal>

<nz-modal [(nzVisible)]="isChangeMobileVisible"
          nzTitle="修改手机号"
          (nzOnCancel)="handleCancel('mobile')"
          (nzOnOk)="handleOk('mobile')"
          [nzOkDisabled]="changeMobileForm.invalid"
          [nzOkLoading]="isOkLoading">
  <form nz-form nzLayout="vertical" [formGroup]="changeMobileForm">
    <nz-form-item>
      <nz-form-label>手机号</nz-form-label>
      <nz-form-control nzHasFeedback>
        <input nz-input formControlName="newMobile"/>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item>
      <nz-form-label>验证码</nz-form-label>
      <nz-form-control>
        <nz-row [nzGutter]="8">
          <nz-col [nzSpan]="16">
            <nz-input-group nzSize="large">
              <input nz-input formControlName="smsCode" [placeholder]="'验证码'"/>
            </nz-input-group>
          </nz-col>
          <nz-col [nzSpan]="8">
            <button type="button" nz-button nzSize="large" (click)="getCaptcha('mobile')" [disabled]="count" nzBlock
                    [nzLoading]="isCaptchaLoading">
              {{ count ? count + 's' : '获取验证码' }}
            </button>
          </nz-col>
        </nz-row>
      </nz-form-control>
    </nz-form-item>
  </form>
</nz-modal>



