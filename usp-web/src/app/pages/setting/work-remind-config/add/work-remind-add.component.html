<nz-card [nzBordered]="false" style="margin: -24px;">
  <form nz-form nz-row [nzGutter]="{ md: 8, lg: 24, xl: 48 }" [formGroup]="validateForm" (ngSubmit)="submitForm(validateForm.value)">
    <div nz-row>
      <div nz-col nzSpan="24">
        <nz-form-item>
          <nz-form-label [nzSm]="3" [nzXs]="24">服务商</nz-form-label>
          <nz-form-control [nzSm]="18" [nzXs]="24">{{serviceName}}
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row>
      <div nz-col nzSpan="12">
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>预警名称</nz-form-label>
          <nz-form-control [nzSpan]="16"  [nzErrorTip]="nameErrorTpl">
            <input nz-input formControlName="remindName" style="width: 250px;" placeholder="请输入预警名称"/>
            <ng-template #nameErrorTpl let-control>
              <ng-container *ngIf="control.hasError">
                {{control.errors?.explain}}
              </ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24">行政区划</nz-form-label>
          <nz-form-control [nzSm]="6" [nzXs]="24"  [nzErrorTip]="valueErrorTpl">
            <nz-cascader
              style="width: 250px;"
              nzPlaceHolder="请选择行政区划"
              (ngModelChange)="areaChange($event)"
              nzAllowClear
              nzShowSearch
              [nzOptions]="districts"
              [nzChangeOnSelect]="true"
              formControlName="district">
            </nz-cascader>
          </nz-form-control>
          <ng-template #valueErrorTpl let-control>
            <ng-container *ngIf="control.hasError('required')">
              请选择行政区划！
            </ng-container>
          </ng-template>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" >工单类型</nz-form-label>
          <nz-form-control [nzSm]="6" [nzXs]="24"  [nzErrorTip]="valueErrorTpl">
            <nz-select nzAllowClear
                       style="width: 250px;"
                       formControlName="workType"
                       nzPlaceHolder="请选择工单类型"
                       (nzFocus)="loadWorkType()">
              <nz-option *ngFor="let workType of  workTypeOptions"
                         [nzValue]="workType.id" [nzLabel]="workType.name"
              ></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24">服务网点</nz-form-label>
          <nz-form-control [nzSm]="6" [nzXs]="24"  [nzErrorTip]="serviceBranchErrorTpl">
            <nz-select
              formControlName="serviceBranch"
              style="width: 250px;"
              nzShowSearch
              nzServerSearch
              nzAllowClear
              nzPlaceHolder="请选择服务网点"
              [nzFilterOption]="nzFilterOption" (ngModelChange)="changeServiceBranch()"
              (nzOnSearch)="searchServiceBranch($event)">
              <nz-option *ngFor="let o of serviceBranchOption" [nzLabel]="o.branchName" [nzValue]="o.branchId"> </nz-option>
              <nz-option *ngIf="serviceBranchOptionLoading" nzDisabled nzCustomContent>
                <i nz-icon nzType="loading" class="loading-icon"></i> 加载数据中
              </nz-option>
            </nz-select>
            <ng-template #serviceBranchErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">
                请选择服务网点！
              </ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" >设备网点</nz-form-label>
          <nz-form-control [nzSm]="6" [nzXs]="24" [nzErrorTip]="valueErrorTpl">
            <nz-select
              nzPlaceHolder="请选择设备网点"
              formControlName="deviceBranch"
              style="width: 250px;"
              nzShowSearch
              nzAllowClear
              (nzFocus)="searchDeviceBranch()">
              <nz-option *ngFor="let o of deviceBranchOption" [nzLabel]="o.branchName" [nzValue]="o.branchId"> </nz-option>
              <nz-option *ngIf="deviceBranchOptionLoading" nzDisabled nzCustomContent>
                <i nz-icon nzType="loading" class="loading-icon"></i> 加载数据中
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="12">
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24">委托商</nz-form-label>
          <nz-form-control [nzSm]="6" [nzXs]="24"  [nzErrorTip]="demanderCorpErrorTpl">
            <nz-select
              formControlName="demanderCorp"
              style="width: 250px;"
              nzShowSearch
              nzAllowClear
              nzPlaceHolder="请选择委托商"
              (ngModelChange)="demanderCorpChange()"
              (nzFocus)="searchDemanderCorp()">
              <nz-option *ngFor="let o of demanderCorpOption" [nzLabel]="o.demanderCorpName" [nzValue]="o.demanderCorp"> </nz-option>
              <nz-option *ngIf="demanderCorpOptionLoading" nzDisabled nzCustomContent>
                <i nz-icon nzType="loading" class="loading-icon"></i> 加载数据中
              </nz-option>
            </nz-select>
            <ng-template #demanderCorpErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">
                请选择委托商！
              </ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24">设备大类</nz-form-label>
          <nz-form-control [nzSm]="6" [nzXs]="24"  [nzErrorTip]="valueErrorTpl">
            <nz-select
              formControlName="largeClassId"
              style="width: 250px;"
              nzShowSearch
              nzAllowClear
              nzPlaceHolder="请选择设备大类"
              (nzFocus)="searchLargeClass()"
              (ngModelChange)="largeClassChange()">
              <nz-option *ngFor="let o of largeClassOption" [nzLabel]="o.name" [nzValue]="o.id"> </nz-option>
              <nz-option *ngIf="largeClassOptionLoading" nzDisabled nzCustomContent>
                <i nz-icon nzType="loading" class="loading-icon"></i> 加载数据中
              </nz-option>
            </nz-select>

            <ng-template #valueErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">
                请选择设备大类！
              </ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" >设备类型</nz-form-label>
          <nz-form-control [nzSm]="6" [nzXs]="24"  [nzErrorTip]="valueErrorTpl">
            <nz-select
              nzPlaceHolder="请选择设备类型"
              formControlName="smallClassId"
              style="width: 250px;"
              nzShowSearch
              nzAllowClear
              (nzFocus)="searchSmallClass(validateForm.value.largeClassId)">
              <nz-option *ngFor="let o of smallClassOption" [nzLabel]="o.name" [nzValue]="o.id"> </nz-option>
              <nz-option *ngIf="smallClassOptionLoading" nzDisabled nzCustomContent>
                <i nz-icon nzType="loading" class="loading-icon"></i> 加载数据中
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" >设备品牌</nz-form-label>
          <nz-form-control [nzSm]="6" [nzXs]="24"  [nzErrorTip]="valueErrorTpl">
            <nz-select
              nzPlaceHolder="请选择设备品牌"
              formControlName="brandId"
              style="width: 250px;"
              nzShowSearch
              nzAllowClear
              (nzFocus)="searchBrand()">

              <nz-option *ngFor="let o of brandOption" [nzLabel]="o.name" [nzValue]="o.id"> </nz-option>
              <nz-option *ngIf="brandOptionLoading" nzDisabled nzCustomContent>
                <i nz-icon nzType="loading" class="loading-icon"></i> 加载数据中
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24" >设备型号</nz-form-label>
          <nz-form-control [nzSm]="6" [nzXs]="24"  [nzErrorTip]="valueErrorTpl">
            <nz-select
              nzPlaceHolder="请选择设备型号"
              formControlName="modelId"
              style="width: 250px;"
              nzShowSearch
              nzAllowClear
              (nzFocus)="searchModel()">

              <nz-option *ngFor="let o of modelOption" [nzLabel]="o.name" [nzValue]="o.id"> </nz-option>
              <nz-option *ngIf="modelOptionLoading" nzDisabled nzCustomContent>
                <i nz-icon nzType="loading" class="loading-icon"></i> 加载数据中
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="12">
        <nz-form-item>
          <nz-form-label [nzSm]="6" [nzXs]="24">是否可用</nz-form-label>
          <nz-form-control [nzSm]="6" [nzXs]="24">
            <nz-switch formControlName="enabled" nzCheckedChildren="是" nzUnCheckedChildren="否"></nz-switch>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div nz-row>
      <div nz-col nzSpan="24">
        <nz-form-item>
          <nz-form-label [nzSm]="3" [nzXs]="24">预警条件</nz-form-label>
          <nz-form-control [nzSm]="6" [nzXs]="24"  [nzErrorTip]="valueErrorTpl">
            <i nz-icon nzType="plus-circle" nzTheme="outline" style="color: #FF9F00;font-size: 18px;"
               (click)="addRemindItem()"></i>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="24">
          <nz-col [nzSm]="3" [nzXs]="24" [nzSpan]="4"></nz-col>
          <nz-col [nzSpan]="20">
            <nz-table nzShowSizeChanger
                      [nzBordered]="true"
                      [nzFrontPagination]="false"
                      [nzData]="remindItemList"
                      nzNoResult="无预警条件">
              <thead>
              <tr>
                <th nzWidth="50px">序号</th>
                <th nzWidth="200px">预警类型</th>
                <th nzWidth="150px">预警条件<br>(分钟)</th>
                <th nzWidth="100px">操作</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let remindItem of remindItemList;let index = index">
                <td>{{index + 1}}</td>
                <td>{{remindItem.remindTypeName}}</td>
                <td>{{remindItem.expireTimeMin}}</td>
                <td>
                  <a (click)="modRemindItem(remindItem)">编辑</a>
                  <nz-divider nzType="vertical"></nz-divider>
                  <a (click)="showDeleteConfirm(remindItem.detailId)">删除</a>
                </td>
              </tr>
              </tbody>
            </nz-table>
          </nz-col>
      </div>
    </div>
  </form>
  <div *nzModalFooter>
    <button nz-button type="button" (click)="destroyModal()" class="button-modal-cancel">取消</button>
    <button nz-button nzType="primary" (click)="submitForm(validateForm.value)" [disabled]="!validateForm.valid"
            class="button-modal-submit">提交
    </button>
  </div>
</nz-card>
