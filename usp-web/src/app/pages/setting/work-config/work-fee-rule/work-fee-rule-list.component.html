<nz-layout>
  <nz-content>
    <nz-card [nzBordered]="false">

      <div class="edit-button-div">
        <button nz-button class="icon-add" nzShape="round" (click)="add()"
                [acl]="{ability: [aclRight.WORK_ASSORT_FEE_ADD]}">新建
        </button>
        <button nz-button class="img-filtrate" nzShape="round" (click)="openDrawer()">筛选</button>
      </div>
      <ng-template #totalTemplate let-total>
        共{{total}}条
      </ng-template>
      <nz-table #headerTable
                nzShowSizeChanger
                nzBordered
                [nzFrontPagination]="false"
                [nzData]="workFeeAssortList"
                [nzLoading]="loading"
                [nzTotal]="page.total"
                [nzShowTotal]="totalTemplate"
                [(nzPageIndex)]="page.pageNum"
                [(nzPageSize)]="page.pageSize"
                (nzPageIndexChange)="query()"
                (nzPageSizeChange)="query(true)"
                [nzScroll]="{x : '2460px'}"
      >
        <thead>
        <tr>
          <th nzWidth="50px" nzLeft="0">序号</th>
          <th nzWidth="250px" nzLeft="50px">费用名称</th>
          <th nzWidth="100px" nzLeft="300px">委托商</th>
          <th nzWidth="80px" nzLeft="400px">费用金额</th>
          <th nzWidth="100px">用于协同人员</th>
          <th nzWidth="100px">工单类型</th>
          <th nzWidth="100px">服务项目</th>
          <th nzWidth="100px">设备大类</th>
          <th>设备类型</th>
          <th>设备规格</th>
          <th>品牌</th>
          <th>型号</th>
          <th nzWidth="100px">客户</th>
          <th nzWidth="100px">适用起始日期</th>
          <th nzWidth="100px">适用截止日期</th>
          <th nzWidth="100px">服务方式</th>
          <th nzWidth="100px">分布</th>
          <th>行政区划</th>
          <th nzWidth="80px">是否可用</th>
          <th nzWidth="100px" nzRight="0"
              [acl]="{ability: [aclRight.WORK_ASSORT_FEE_MOD]}">操作
          </th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let data of headerTable.data;let i = index">
          <td nzLeft="0">{{page.getNo(i)}}</td>
          <td nzAlign="left" nzLeft="50px">{{data.assortName}}</td>
          <td nzAlign="left" nzLeft="300px">{{ data.demanderCorpName }}</td>
          <td nzAlign="right" nzLeft="400px">{{data.amount | currency: 'CNY': 'symbol-narrow': '1.0-2'}}</td>
          <td nzAlign="left">{{data.together === 'Y' ? '是' : '否'}}</td>
          <td nzAlign="left">{{data.workTypeName}}</td>
          <td nzAlign="left">{{data.serviceItemName}}</td>
          <td nzAlign="left">{{data.largeClassName}}</td>
          <td nzAlign="left">{{data.smallClassName}}</td>
          <td nzAlign="left">{{data.specificationName}}</td>
          <td nzAlign="left">{{data.brandName}}</td>
          <td nzAlign="left">{{data.modelName}}</td>
          <td nzAlign="left">{{data.customCorpName}}</td>
          <td>{{data.startDate | date:'yyyy-MM-dd'}}</td>
          <td>{{data.endDate | date:'yyyy-MM-dd'}}</td>
          <td nzAlign="left">{{data.serviceModeName}}</td>
          <td nzAlign="left">{{data.zoneName}}</td>
          <td nzAlign="left">
            <label *ngIf="data.districtName && data.districtNegate === 'Y'" style="color: red">排除:</label>
            <label *ngIf="data.districtName && data.districtNegate === 'N'" style="color: red">包含:</label>
            {{data.districtName}}
          </td>
          <td>
            <span *ngIf="data.enabled === 'Y'">是</span>
            <span *ngIf="data.enabled === 'N'" style="color: red">否</span>
          </td>
          <td nzRight="0" [acl]="{ability: [aclRight.WORK_ASSORT_FEE_MOD, aclRight.WORK_ASSORT_FEE_ADD]}">
            <a [acl]="{ability: [aclRight.WORK_ASSORT_FEE_MOD]}" (click)="mod(data)">编辑</a>
            <nz-divider
              [acl]="{ability: [aclRight.WORK_ASSORT_FEE_MOD, aclRight.WORK_ASSORT_FEE_ADD], mode: 'allOf'}"
              nzType="vertical"></nz-divider>
            <a [acl]="{ability: [aclRight.WORK_ASSORT_FEE_ADD]}" (click)="copy(data)">复制</a>
          </td>
        </tr>
        </tbody>
      </nz-table>
    </nz-card>
  </nz-content>
  <nz-drawer nzTitle="筛选" [nzVisible]="drawerVisible" nzWidth="300px" (nzOnClose)="closeDrawer()"
             [nzClosable]="'true'">
    <form nz-form [nzLayout]="'inline'" [formGroup]="searchForm">

      <nz-form-item>
        <nz-form-label>委托商</nz-form-label>
        <nz-form-control>
          <nz-select nzShowSearch formControlName="demanderCorp" style="width: 220px;"
                     nzAllowClear nzPlaceHolder="请选择委托商">
            <nz-option *ngFor="let demanderCorp of demanderCorpList" [nzValue]="demanderCorp.demanderCorp"
                       [nzLabel]="demanderCorp.demanderCorpName"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>费用名称</nz-form-label>
        <nz-form-control>
          <nz-input-group [nzSuffix]="assortNameTemplate">
            <input style="width: 220px" type="text" nz-input formControlName="assortName" placeholder="请输入费用名称"/>
          </nz-input-group>
          <ng-template #assortNameTemplate>
            <i
              nz-icon
              nz-tooltip
              class="ant-input-clear-icon"
              nzTheme="fill"
              nzType="close-circle"
              *ngIf="searchForm.value.assortName"
              (click)="searchForm.controls.assortName.setValue('');"
            ></i>
          </ng-template>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>是否可用</nz-form-label>
        <nz-form-control>
          <nz-select formControlName="enabled" style="width: 220px;"
                     nzAllowClear nzPlaceHolder="是/否">
            <nz-option [nzValue]="'Y'" nzLabel="是"></nz-option>
            <nz-option [nzValue]="'N'" nzLabel="否"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <div style="text-align: right;margin-top: 40px">
        <button class="ant-btn" style="margin-left: 8px;margin-right: 10px;" nz-button (click)="clearDrawer();"><span>清空筛选</span>
        </button>
        <button nz-button [nzType]="'primary'" (click)="closeDrawer();query(true)">查询</button>
      </div>
    </form>
  </nz-drawer>
</nz-layout>

