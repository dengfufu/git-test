<nz-layout>
  <nz-content>
    <nz-card [nzBordered]="false">

      <div class="edit-button-div">
        <!--<i  nz-icon nzType="plus-circle" nzTheme="outline" class="icon-add" (click)="addWorkTypeModal()" nz-tooltip
            nzTooltipTitle="新建" [acl]="{ability: [aclRight.WORK_TYPE_ADD]}"></i>
        <i nz-icon nzType="anyfix:filtrate" nzTheme="outline" class="img-filtrate" (click)="openDrawer()" nz-tooltip
           nzTooltipTitle="筛选"></i>-->
        <button nz-button class="icon-add" nzShape="round" (click)="addWorkTypeModal()"
                [acl]="{ability: [aclRight.WORK_TYPE_ADD]}">新建
        </button>
        <button nz-button class="img-filtrate" nzShape="round" (click)="openDrawer()">筛选</button>
      </div>

      <nz-table #headerTable
                nzShowSizeChanger
                nzBordered
                [nzFrontPagination]="false"
                [nzData]="list"
                [nzLoading]="loading"
                [nzTotal]="page.total"
                [(nzPageIndex)]="page.pageNum"
                [(nzPageSize)]="page.pageSize"
                (nzPageIndexChange)="queryWorkType()"
                (nzPageSizeChange)="queryWorkType(true)">
        <thead>
        <tr>
          <th style="width: 50px">序号</th>
          <th>委托商</th>
          <th>工单类型</th>
          <th>系统类型</th>
          <th>详细描述</th>
          <th style="width: 100px">是否可用</th>
          <th style="width: 100px" [acl]="{ability: [aclRight.WORK_TYPE_MOD, aclRight.WORK_TYPE_DEL]}">操作</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let data of headerTable.data;let index = index">
          <td>{{ page.getNo(index) }}</td>
          <td nzAlign="center">{{data.demanderCorp == '0' ? '适用所有委托商' : data.demanderCorpName}}</td>
          <td>{{ data.name }}</td>
          <td>{{ data.sysTypeName }}</td>
          <td>{{ data.description }}</td>
          <td *ngIf="data.enabled === 'Y'">是</td>
          <td *ngIf="data.enabled !== 'Y'"><span style="color: red">否</span></td>
          <td [acl]="{ability: [aclRight.WORK_TYPE_MOD, aclRight.WORK_TYPE_DEL]}">
            <a [acl]="{ability: [aclRight.WORK_TYPE_MOD]}" (click)="editWorkTypeModal(data)"
               *ngIf="data.demanderCorp > 0">编辑</a>
            <nz-divider [acl]="{ability: [aclRight.WORK_TYPE_MOD, aclRight.WORK_TYPE_DEL], mode: 'allOf'}"
                        nzType="vertical" *ngIf="data.demanderCorp > 0"></nz-divider>
            <a [acl]="{ability: [aclRight.WORK_TYPE_DEL]}" (click)="showDeleteConfirm(data.id);"
               *ngIf="data.demanderCorp > 0">删除</a>
          </td>
        </tr>
        </tbody>
      </nz-table>
    </nz-card>
  </nz-content>
  <nz-drawer nzTitle="工单类型筛选" [nzVisible]="drawerVisible" nzWidth="300px" (nzOnClose)="closeDrawer()"
             [nzClosable]="'true'">
    <form nz-form [nzLayout]="'inline'" [formGroup]="searchForm">
      <nz-form-item>
        <nz-form-label >委托商</nz-form-label>
        <nz-form-control [nzErrorTip]="searchForm.controls.demanderCorp.errors?.explain">
          <nz-select nzShowSearch formControlName="demanderCorp" style="width: 250px;"
                     nzAllowClear nzPlaceHolder="请选择委托商">
            <nz-option *ngFor="let demanderCorp of demanderCorpList" [nzValue]="demanderCorp.demanderCorp"
                       [nzLabel]="demanderCorp.demanderCorpName"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>工单类型</nz-form-label>
        <nz-form-control>
          <input nz-input style="width: 250px;" formControlName="name" maxlength="20" placeholder="请输入工单类型"/>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>系统类型</nz-form-label>
        <nz-form-control>
          <nz-select nzAllowClear="true" style="width: 250px;" formControlName="sysType"
                     nzPlaceHolder="请选择系统类型">
            <nz-option *ngFor="let o of workSysTypeList" [nzLabel]="o.name" [nzValue]="o.code"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>是否可用</nz-form-label>
        <nz-form-control>
          <nz-select nzAllowClear="true" style="width: 250px;" formControlName="enabled"
                     nzPlaceHolder="是/否">
            <nz-option nzLabel="是" nzValue="Y"></nz-option>
            <nz-option nzLabel="否" nzValue="N"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <div style="text-align: right;margin-top: 40px">
        <button class="ant-btn" style="margin-left: 8px;margin-right: 10px;" nz-button (click)="clearDrawer();"><span>清空筛选</span>
        </button>
        <button nz-button [nzType]="'primary'" (click)="closeDrawer();queryWorkType(true)">查询</button>
      </div>
    </form>
  </nz-drawer>
</nz-layout>
