<nz-layout>
  <nz-content>
    <nz-card [nzBordered]="false">

      <div class="edit-button-div">
        <!--<i  nz-icon nzType="plus-circle" nzTheme="outline" class="icon-add" (click)="add()" nz-tooltip
            nzTooltipTitle="新建" [acl]="{ability: [aclRight.DISPATCH_SERVICE_BRANCH_ADD]}"></i>
        <i nz-icon nzType="anyfix:filtrate" nzTheme="outline" class="img-filtrate" (click)="openDrawer()" nz-tooltip
           nzTooltipTitle="筛选"></i>-->
        <button nz-button  class="icon-add" nzShape="round"  (click)="add()" [acl]="{ability: [aclRight.DISPATCH_SERVICE_BRANCH_ADD]}">新建</button>
        <button nz-button  class="img-filtrate" nzShape="round"  (click)="openDrawer()">筛选</button>
      </div>
      <nz-table #headerTable
                nzShowSizeChanger
                nzBordered
                [nzFrontPagination]="false"
                [nzData]="serviceBranchList"
                [nzLoading]="loading"
                [nzTotal]="page.total"
                [(nzPageIndex)]="page.pageNum"
                [(nzPageSize)]="page.pageSize"
                (nzPageIndexChange)="query()"
                (nzPageSizeChange)="query(true)">
        <thead>
        <tr>
          <th nzWidth="50px">序号</th>
          <th nzWidth="150px">服务商</th>
          <th nzWidth="150px">委托商</th>
          <th nzWidth="150px">服务网点</th>
          <th nzWidth="100px">工单类型</th>
          <th nzWidth="100px">受理方式</th>
          <th>大类</th>
          <th>设备类型</th>
          <th>品牌</th>
          <th>型号</th>
          <th>行政区域</th>
          <th>设备网点</th>
          <th nzWidth="100px"
              [acl]="{ability: [aclRight.DISPATCH_SERVICE_BRANCH_MOD, aclRight.DISPATCH_SERVICE_BRANCH_DEL]}">操作
          </th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let data of headerTable.data;let i = index">
          <td nzAlign="center">{{page.getNo(i)}}</td>
          <td><span style="display: block">{{ data.serviceCorpName }}</span></td>
          <td><span style="display: block">{{ data.demanderCorpName }}</span></td>
          <td><span style="display: block">{{ data.serviceBranchName }}</span></td>
          <td><span style="display: block">{{data.workTypeName}}</span></td>
          <td><span style="display: block">{{data.handleTypeName}}</span></td>
          <td><span style="display: block">{{data.largeClassName}}</span></td>
          <td><span style="display: block">{{data.smallClassName}}</span></td>
          <td><span style="display: block">{{data.brandName}}</span></td>
          <td><span style="display: block">{{data.modelName}}</span></td>
          <td><span style="display: block">{{data.districtName}}</span></td>
          <td><span style="display: block">{{data.deviceBranchName}}</span></td>
          <td nowrap [acl]="{ability: [aclRight.DISPATCH_SERVICE_BRANCH_MOD, aclRight.DISPATCH_SERVICE_BRANCH_DEL]}">
            <a [acl]="{ability: [aclRight.DISPATCH_SERVICE_BRANCH_MOD]}" (click)="mod(data)">编辑</a>
            <nz-divider
              [acl]="{ability: [aclRight.DISPATCH_SERVICE_BRANCH_MOD, aclRight.DISPATCH_SERVICE_BRANCH_DEL], mode: 'allOf'}"
              nzType="vertical"></nz-divider>
            <a [acl]="{ability: [aclRight.DISPATCH_SERVICE_BRANCH_DEL]}" (click)="showDeleteConfirm(data.id);">删除</a>
          </td>
        </tr>
        </tbody>
      </nz-table>
    </nz-card>
  </nz-content>
  <nz-drawer nzTitle="自动分配服务网点筛选" [nzVisible]="drawerVisible" nzWidth="400px" (nzOnClose)="closeDrawer()"
             [nzClosable]="'true'">
    <form nz-form [nzLayout]="'inline'" [formGroup]="searchForm">
      <nz-form-item>
        <nz-form-label nzFor="customCorp">委托商</nz-form-label>
        <nz-form-control>
          <nz-select
            formControlName="demanderCorp"
            style="width: 300px;"
            nzShowSearch
            nzAllowClear
            nzPlaceHolder="请选择委托商"
            (nzFocus)="searchDemanderCorp()">
            <nz-option *ngFor="let o of demanderCorpOption" [nzLabel]="o.demanderCorpName"
                       [nzValue]="o.demanderCorp"></nz-option>
            <nz-option *ngIf="demanderCorpOptionLoading" nzDisabled nzCustomContent>
              <i nz-icon nzType="loading" class="loading-icon"></i> 加载数据中
            </nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzFor="workType">服务网点</nz-form-label>
        <nz-form-control>
          <nz-select
            formControlName="serviceBranch"
            style="width: 300px;"
            nzShowSearch
            nzServerSearch
            nzAllowClear
            nzPlaceHolder="请选择服务网点"
            [nzFilterOption]="nzFilterOption"
            (nzOnSearch)="searchServiceBranch($event)">
            <nz-option *ngFor="let o of serviceBranchOption" [nzLabel]="o.branchName"
                       [nzValue]="o.branchId"></nz-option>
            <nz-option *ngIf="serviceBranchOptionLoading" nzDisabled nzCustomContent>
              <i nz-icon nzType="loading" class="loading-icon"></i> 加载数据中
            </nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzFor="customCorp">行政区划</nz-form-label>
        <nz-form-control>
          <nz-cascader
            formControlName="district"
            style="width: 300px;"
            [nzExpandTrigger]="'click'"
            [nzChangeOnSelect]="true"
            [nzShowSearch]="ZorroUtils.showSearchOptions"
            nzAllowClear
            nzPlaceHolder="省/市/区"
            [nzOptions]="areaOption"
          >
          </nz-cascader >
        </nz-form-control>
      </nz-form-item>

      <div style="text-align: right;margin-top: 40px">
        <button class="ant-btn" style="margin-left: 8px;margin-right: 10px;" nz-button (click)="clearDrawer();"><span>清空筛选</span>
        </button>
        <button nz-button [nzType]="'primary'" (click)="useFormValue=true;closeDrawer();query(true)">查询</button>
      </div>
    </form>
  </nz-drawer>
</nz-layout>
