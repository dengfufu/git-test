<nz-page-header [nzBackIcon]="backIcon">
  <nz-page-header-title>申请调拨</nz-page-header-title>
  <nz-page-header-extra>
    <button nz-button (click)="goBack()" nzType="primary" nzShape="round">返回</button>
    <button nz-button nzType="primary" nzShape="round" (click)="addSubmit()" [disabled]="!submitForm.valid && transDetailCommonSaveDtoList.length <1" >提交</button>
  </nz-page-header-extra>
</nz-page-header>

<ng-template #backIcon>
  <img src="assets/go-back.svg" style="padding-right: 20px;">
</ng-template>

<nz-layout>
  <div nz-row class="layout-row">
    <div nz-col class="layout-col" nzSpan="10">
      <nz-card [nzBordered]="false">
        <form [formGroup]="submitForm">
<!--        <div class="div-row" nz-row>-->
<!--          <nz-form-item>-->
<!--            <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>申请人</nz-form-label>-->
<!--            <nz-form-control [nzSm]="14" [nzXs]="24" [nzErrorTip]="applicantErrorTip">-->
<!--              <nz-select nzShowSearch nzAllowClear formControlName="createBy" nzPlaceHolder="请选择申请人" >-->
<!--                <nz-option *ngFor="let item of selectOptions.applicantOptions" [nzValue]="item.id"-->
<!--                           [nzLabel]="item.name"></nz-option>-->
<!--              </nz-select>-->
<!--              <ng-template #applicantErrorTip let-control>-->
<!--                <ng-container *ngIf="control.hasError('required')">-->
<!--                  请选择设备分类！-->
<!--                </ng-container>-->
<!--              </ng-template>-->
<!--            </nz-form-control>-->
<!--          </nz-form-item>-->
<!--        </div>-->

        <div class="div-row" nz-row>
          <nz-form-item>
            <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>申请库房</nz-form-label>
            <nz-form-control [nzSm]="14" [nzXs]="24" [nzErrorTip]="">
              <nz-select nzShowSearch nzAllowClear
                         formControlName="toDepotId"
                         nzPlaceHolder="请选择申请库房"
                         (nzOnSearch)="queryDepotList($event)">
                <nz-option *ngFor="let item of fromDepotSelectionOptions" [nzValue]="item.id"
                           [nzLabel]="item.name"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div class="div-row" nz-row>
          <nz-form-item>
            <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>申请日期</nz-form-label>
            <nz-form-control [nzSm]="14" [nzXs]="24" [nzErrorTip]="">
                <nz-date-picker formControlName="applyDate"  [nzFormat]="'yyyy-MM-dd'"
                                   ></nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div class="div-row" nz-row>
          <nz-form-item>
            <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>紧急程度</nz-form-label>
            <nz-form-control [nzSm]="14" [nzXs]="24" [nzErrorTip]="">
              <nz-select nzShowSearch nzAllowClear formControlName="priorityLevel" nzPlaceHolder="请选择紧急程度">
                <nz-option *ngFor="let item of selectOptions.priorityOptions" [nzValue]="item.id"
                           [nzLabel]="item.name"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div class="div-row" nz-row>
          <nz-form-item>
            <nz-form-label [nzSm]="6" [nzXs]="24" >申请原因</nz-form-label>
            <nz-form-control [nzSm]="14" [nzXs]="24" [nzErrorTip]="">
             <textarea
               nz-input
               placeholder="请输入原因"
               formControlName="description"
               [nzAutosize]="{ minRows: 2, maxRows: 6 }"
             ></textarea>
            </nz-form-control>
          </nz-form-item>
        </div>
        </form>
      </nz-card>
    </div>

    <div nz-col class="layout-col" nzSpan="14">
      <nz-card style="border-width: 0 0 0 1px">
        <form [formGroup]="addDetailForm">
        <div nz-row>

          <div nz-col nzSpan="12">
            <nz-form-item>
              <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>备件名称</nz-form-label>
              <nz-form-control [nzSm]="14" [nzXs]="24" [nzErrorTip]="">
                <nz-select nzShowSearch nzAllowClear formControlName="catalog" nzPlaceHolder="请选择备件名称"
                           (nzOnSearch)="wmsService.queryCatalogList($event)">
                  <nz-option *ngFor="let item of wmsService.selectOptions.catalogList" [nzValue]="item"
                             [nzLabel]="item.name"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>备件品牌</nz-form-label>
              <nz-form-control [nzSm]="14" [nzXs]="24">
                <nz-select
                  nzShowSearch
                  nzAllowClear
                  formControlName="brand"
                  nzPlaceHolder="请选择备件品牌"
                  (ngModelChange)="brandChange($event)"
                  [nzServerSearch]="true"
                  (nzOnSearch)="wmsService.queryBrandList($event)"
                >
                  <nz-option *ngFor="let brand of wmsService.selectOptions.brandList" [nzValue]="brand"
                             [nzLabel]="brand.name"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>申请数量</nz-form-label>
              <nz-form-control [nzSm]="14" [nzXs]="24">
                <nz-input-number
                  [nzMin]="1"
                  [nzMax]="1000000"
                  [nzStep]="1"
                  formControlName="applyQuantity"
                ></nz-input-number>
              </nz-form-control>
            </nz-form-item>

            <nz-form-item>
              <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>备件型号</nz-form-label>
              <nz-form-control [nzSm]="14" [nzXs]="24">
                <nz-select
                  nzShowSearch
                  nzAllowClear
                  formControlName="model"
                  nzPlaceHolder="请选择备件型号"
                  [nzServerSearch]="true"
                  (nzOnSearch)="wmsService.queryModelList($event, addDetailForm.value.catalog.id, addDetailForm.value.brand.id)"
                >
                  <nz-option *ngFor="let model of wmsService.selectOptions.modelList" [nzValue]="model"
                             [nzLabel]="model.name"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>

          <div nz-col nzSpan="12">
            <nz-form-item>
              <nz-form-label [nzSm]="6" [nzXs]="24" >备件状态</nz-form-label>
              <nz-form-control [nzSm]="14" [nzXs]="24">
                <nz-select
                  nzShowSearch
                  nzAllowClear
                  formControlName="status"
                  nzPlaceHolder="请选择备件状态"
                  [nzServerSearch]="true"
                  (nzOnSearch)="wmsService.queryStatusList($event)"
                >
                  <nz-option *ngFor="let status of wmsService.selectOptions.statusList" [nzValue]="status"
                             [nzLabel]="status.name"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>

          <div nz-col nzSpan="12">
            <div *ngIf="selectOptions.normsList.length > 0">
              <div nz-row nzType="flex" nzAlign="middle" style="height: 40px">
                <nz-form-label [nzSm]="6" [nzXs]="24" >备件规格</nz-form-label>
              </div>
              <div nz-row style="height: 40px" nzType="flex" nzAlign="middle" *ngFor="let item of selectOptions.normsList">
                <div nz-col nzSpan="6" style="text-align: right">
                  <label  style="font-size: 13px;font-weight: bolder;color: rgba(0, 0, 0, 0.85)">{{item.attribute}}：</label>
                </div>
                <div nz-col nzSpan="18" style="text-align: left">
                  <nz-select   [ngModelOptions]="{standalone: true}"  style="width: 200px"  [(ngModel)]="normsValue[item.attribute]" nzShowSearch nzAllowClear *ngIf="item.value.length > 0">
                    <nz-option  *ngFor="let value of item.value" [nzValue]="value"
                               [nzLabel]="value"></nz-option>
                  </nz-select>
                  <input nz-input [(ngModel)]="normsValue[item.attribute]" [ngModelOptions]="{standalone: true}"  style="width: 200px" *ngIf="item.value.length <= 0"/>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div nz-row class="div-row" nzAlign="bottom">
          <button nz-button nzType="primary"

                  style="margin:10px 30px 0 0" nzSize="small" nzShape="round" (click)="addDetail()">加入列表</button>
          <button nz-button style="margin:10px 30px 0 0" nzSize="small" nzShape="round" (click)="clearDetailForm()">清空</button>
        </div>
        </form>
      </nz-card>
    </div>
  </div>


  <div nz-row>
    <nz-card style="border-width: 1px 0 0 0">
      <p class="p-title">申请备件调拨列表</p>
      <nz-table
        nzBordered
        nzHideOnSinglePage
        nzFrontPagination="true"
        nzShowSizeChanger
        [nzPageIndex]="page.pageNum"
        [nzPageSize]="page.pageSize"
        [nzData]="transDetailCommonSaveDtoList"
        [nzTotal]="transDetailCommonSaveDtoList.length"
        nzLoadingDelay="100"
        nzNoResult="无"
      >
        <thead>
          <tr>
            <th nzWidth="50px">序号</th>
            <th>备件名称</th>
            <th>品牌</th>
            <th>规格</th>
            <th>型号</th>
            <th>数量</th>
            <th>备件状态</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of transDetailCommonSaveDtoList; let index = index">
            <td nzAlign="center">{{ page.getNo(index) }}</td>
            <td nzAlign="left">{{ data.catalogName }}</td>
            <td nzAlign="left">{{ data.brandName }}</td>
            <td nzAlign="left">{{ data.normsValue }}</td>
            <td nzAlign="left">{{ data.modelName }}</td>
            <td nzAlign="left">{{ data.applyQuantity }}</td>
            <td nzAlign="left">{{ data.statusName }}</td>
            <td nzAlign="center"><img src="/assets/wms/close-circle.svg" (click)="deleteDetail(index)" style="width: 20px;height: 20px;"></td>
          </tr>
        </tbody>
      </nz-table>
    </nz-card>
  </div>

</nz-layout>

