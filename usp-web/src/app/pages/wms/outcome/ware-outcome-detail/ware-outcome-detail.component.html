<nz-page-header nzBackIcon>
  <nz-page-header-title>出库详情</nz-page-header-title>
  <nz-page-header-extra>
    <button nz-button nzType="primary" (click)="goBack()">返回</button>
    <button nz-button nzType="primary" (click)="auditWare()"
            *ngIf="flowNodeType == 20 || flowNodeType == 30 || flowNodeType == 60">审核
    </button>
    <button nz-button nzType="primary" (click)="receive()" *ngIf="flowNodeType == 50">收货</button>
    <button nz-button nzType="primary" (click)="consign()" *ngIf="flowNodeType == 40">发货</button>

  </nz-page-header-extra>
</nz-page-header>
<nz-layout>
  <div nz-row style="background-color: white">
    <div nz-col nzSpan="6">
      <nz-card style="width:100%;border-width: 0 1px 0 0">
        <div class="div-row" nz-row nzAlign="middle" style="text-align: right">
          <div nz-col class="label-item" nzSpan="8">申请单号：</div>
          <div nz-col nzSpan="8">{{outcomeDetail.outcomeCode}}</div>
        </div>
        <div class="div-row" nz-row>
          <div nz-col class="label-item" nzSpan="8">状态：</div>
          <button nz-button class="button-status" [ngStyle]="getButtonColor(flowNodeType)"
                  *ngIf="outcomeDetail.outcomeStatus === 10">{{this.wmsService.mapOptions.statusMap[flowNodeType]}}</button>
          <button nz-button class="button-status" *ngIf="outcomeDetail.outcomeStatus === 20"
                  [ngStyle]="{'background-color': '#FFBD50'}">已出库
          </button>
        </div>
        <div class="div-row" nz-row>
          <div nz-col class="label-item" nzSpan="8">出库地点：</div>
          <div nz-col nzSpan="16">{{outcomeDetail.depotName}}</div>
        </div>
        <div class="div-row" nz-row>
          <div nz-col class="label-item" nzSpan="8">申请人：</div>
          <div nz-col nzSpan="16">{{outcomeDetail.createBy}}</div>
        </div>
        <div class="div-row" nz-row>
          <div nz-col class="label-item" nzSpan="8">出库类别：</div>
          <div nz-col nzSpan="16">{{outcomeDetail.smallClassName}}</div>
        </div>
        <div class="div-row" nz-row>
          <div nz-col class="label-item" nzSpan="8">申请时间：</div>
          <div nz-col nzSpan="16">{{outcomeDetail.applyDate}}</div>
        </div>
        <div class="div-row" nz-row>
          <div nz-col class="label-item" nzSpan="8">出库原因：</div>
          <div nz-col nzSpan="16">{{outcomeDetail.description}}</div>
        </div>
        <div *ngIf="consignList[0].consignCode != null">
          <nz-divider nzDashed="true" style="padding: 0px;"></nz-divider>
          <div class="div-row" nz-row>
            <div nz-col class="label-item" nzSpan="8">发货单号：</div>
            <div nz-col nzSpan="16">{{consignList[0].consignCode}}</div>
          </div>
          <div class="div-row" nz-row>
            <div nz-col class="label-item" nzSpan="8">发货时间：</div>
            <div nz-col nzSpan="16">{{consignList[0].consignDate}}</div>
          </div>
          <div class="div-row" nz-row>
            <div nz-col class="label-item" nzSpan="8">发货人：</div>
            <div nz-col nzSpan="16">{{consignList[0].consignByName}}</div>
          </div>
        </div>
        <div *ngIf="consignList[0].receiveName != null">
          <nz-divider nzDashed="true" style="padding: 0px;"></nz-divider>
          <div class="div-row" nz-row>
            <div nz-col class="label-item" nzSpan="8">收货人：</div>
            <div nz-col nzSpan="16">{{consignList[0].receiveName}}</div>
          </div>
          <div class="div-row" nz-row>
            <div nz-col class="label-item" nzSpan="8">收货人电话：</div>
            <div nz-col nzSpan="16">{{consignList[0].receiverMobile}}</div>
          </div>
          <div class="div-row" nz-row>
            <div nz-col class="label-item" nzSpan="8">收货地址：</div>
            <div nz-col nzSpan="16">{{consignList[0].receiveDistrictAddress }}{{consignList[0].receiveAddress}}</div>
          </div>
          <div class="div-row" nz-row>
            <div nz-col class="label-item" nzSpan="8">运送方式：</div>
            <div nz-col nzSpan="16">{{consignList[0].transportTypeName}}</div>
          </div>
          <div class="div-row" nz-row>
            <div nz-col class="label-item" nzSpan="8">快递公司：</div>
            <div nz-col nzSpan="16">{{consignList[0].expressCorpName}}</div>
          </div>
        </div>
      </nz-card>
    </div>
    <div nz-col nzSpan="18" style="height: 100%">
      <div nz-row style="height: 30%">
        <nz-card style="width: 100%;height: 100%;border-width: 0 0 1px 0">
          <nz-steps nzSize="small" [nzCurrent]="1" [nzLabelPlacement]="'vertical'">
            <nz-step
              *ngFor="let item of flowInstanceNodeList"
              [nzTitle]="item.templateNodeName"
              [nzIcon]="item.completed == 'Y' ? finishTemplate : waitTemplate"
              [nzDescription]="item.completedTime | date: 'yyyy-MM-dd HH:mm:ss'"
              [nzStatus]="item.completed == 'Y' ? 'finish' : 'wait'"
            ></nz-step>
            <ng-template #finishTemplate><i nz-icon style="font-size: 40px" nzType="wms:green-round"></i></ng-template>
            <ng-template #waitTemplate><i nz-icon style="font-size: 40px" nzType="wms:gray-round"></i></ng-template>
          </nz-steps>
        </nz-card>
      </div>
      <div nz-row style="height: 70%">
        <nz-card nzBordered="false">
          <nz-tabset [nzTabBarStyle]="">
            <nz-tab nzTitle="申请备件清单">
              <nz-table
                nzShowSizeChanger
                nzShowPagination
                nzBordered
                [nzData]="[{}]"
              >
                <thead>
                <tr>
                  <th>物料名称</th>
                  <th>品牌</th>
                  <th>型号</th>
                  <th>规格</th>
                  <th>物料状态</th>
                  <th>唯一编码</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                  <td>{{ outcomeDetail.catalogName }}</td>
                  <td>{{ outcomeDetail.brandName }}</td>
                  <td>{{ outcomeDetail.modelName }}</td>
                  <td>{{ outcomeDetail.normsValue }}</td>
                  <td>{{ outcomeDetail.statusName }}</td>
                  <td>{{ outcomeDetail.barcode }}</td>
                </tr>
                </tbody>
              </nz-table>
            </nz-tab>
            <nz-tab nzTitle="审核">
              <nz-table
                nzBordered
                nzShowPagination="false"
                nzShowSizeChanger
                nzNoResult="无"
                #flowTraceTable
                [nzData]="flowInstanceTraceList"
              >
                <thead>
                <tr>
                  <th nzWidth="50px">序号</th>
                  <th>审批节点</th>
                  <th>审批人</th>
                  <th>审批结果</th>
                  <th>审批意见</th>
                  <th>审批时间</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let data of flowTraceTable.data;let index = index">
                  <td>{{ index + 1 }}</td>
                  <td>{{ data.templateNodeName}}</td>
                  <td>{{ data.completedByName }}</td>
                  <td>{{ data.dealResultName }}</td>
                  <td>{{ data.completedDescription }}</td>
                  <td>{{ data.completedTime | date: 'yyyy-MM-dd HH:mm:ss' }}</td>
                </tr>
                </tbody>
              </nz-table>
            </nz-tab>
            <nz-tab nzTitle="发货清单" (nzClick)="queryConsignInfo()">
              <nz-descriptions nzTitle="备件信息" nzBordered>
                <nz-descriptions-item nzTitle="名称" nzSpan="2">{{ outcomeDetail.catalogName }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="品牌" nzSpan="2">{{ outcomeDetail.brandName }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="型号" nzSpan="2">{{ outcomeDetail.modelName }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="规格" nzSpan="2">{{ outcomeDetail.normsValue }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="备件状态" nzSpan="2">{{ outcomeDetail.statusName }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="唯一编码" nzSpan="2">{{ outcomeDetail.barcode }}</nz-descriptions-item>
              </nz-descriptions>

              <br>
              <p>发货信息</p>
              <nz-table
                nzBordered
                nzShowPagination="false"
                nzShowSizeChanger
                [nzData]="consignList"
              >
                <thead>
                <tr>
                  <th nzWidth="50px">序号</th>
                  <th>快递公司</th>
                  <th>单号</th>
                  <th>发货人</th>
                  <th>发货联系方式</th>
                  <th>发货时间</th>
                  <th>此单分箱号</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let data of consignList;let index = index">
                  <td>{{ index + 1 }}</td>
                  <td>{{ data.expressCorpName}}</td>
                  <td>{{ data.expressNo }}</td>
                  <td>{{ data.consignByName}}</td>
                  <td>{{ data.consignMobile }}</td>
                  <td>{{ data.createTime | date: 'yyyy-MM-dd HH:mm:ss' }}</td>
                  <td>{{data.subBoxNum}}</td>
                </tr>
                </tbody>
              </nz-table>
            </nz-tab>
            <nz-tab nzTitle="收货清单">
              <nz-descriptions nzTitle="备件信息" nzBordered>
                <nz-descriptions-item nzTitle="名称" nzSpan="2">{{ outcomeDetail.catalogName }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="品牌" nzSpan="2">{{ outcomeDetail.brandName }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="型号" nzSpan="2">{{ outcomeDetail.modelName }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="规格" nzSpan="2">{{ outcomeDetail.normsValue }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="备件状态" nzSpan="2">{{ outcomeDetail.statusName }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="唯一编码" nzSpan="2">{{ outcomeDetail.barcode }}</nz-descriptions-item>
              </nz-descriptions>

              <br>
              <p>收货信息</p>
              <nz-table
                nzBordered
                nzShowPagination="false"
                nzShowSizeChanger
                [nzData]="consignList"
              >
                <thead>
                <tr>
                  <th nzWidth="50px">序号</th>
                  <th>快递公司</th>
                  <th>单号</th>
                  <th>收货人</th>
                  <th>收货联系方式</th>
                  <th>收货时间</th>
                  <th>此单分箱号</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let data of consignList;let index = index">
                  <td>{{ index + 1 }}</td>
                  <td>{{ data.expressCorpName}}</td>
                  <td>{{ data.expressNo }}</td>
                  <td>{{ data.signByName }}</td>
                  <td>{{ data.receiverMobile }}</td>
                  <td>{{ data.signTime | date: 'yyyy-MM-dd HH:mm:ss' }}</td>
                  <td>{{data.subBoxNum}}</td>
                </tr>
                </tbody>
              </nz-table>
            </nz-tab>
          </nz-tabset>
        </nz-card>
      </div>
    </div>
  </div>
</nz-layout>
