<nz-layout>
  <nz-page-header [nzBackIcon]="backIcon">
    <nz-page-header-title style="margin-left: -10px;">寄送单详情&nbsp;
      <span style="font-size: 16px;font-weight: bold;">{{goodsPost.postNo}}</span></nz-page-header-title>
    <nz-page-header-extra>
      <button nz-button nzShape="round" (click)="goBack()" class="edit-button">返回</button>
      <button nz-button nzShape="round" (click)="editGoodsPost()" class="edit-button"
              *ngIf="ifCanEdit">编辑
      </button>
      <button nz-button nzNoAnimation nz-dropdown [nzDropdownMenu]="menu" class="edit-menu">
        <img class="menu-img" src="assets/drop-menu-theme.svg" style="margin-top: -2px; margin-left: -8px;">
      </button>
      <nz-dropdown-menu #menu="nzDropdownMenu">
        <ul nz-menu>
          <li nz-menu-item (click)="delGoodsPost()"
              *ngIf="ifCanDelete">删除
          </li>
          <li nz-menu-divider></li>
          <li nz-menu-item nzDisabled>无更多操作</li>
        </ul>
      </nz-dropdown-menu>
    </nz-page-header-extra>
  </nz-page-header>
  <ng-template #backIcon>
    <img src="assets/go-back.svg" style="padding-right: 20px;">
  </ng-template>
  <nz-spin [nzSpinning]="spinning">
    <nz-layout>
      <nz-card [nzBordered]="false">
        <div nz-row class="div-row">
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">签收状态：</div>
              <div nz-col nzSpan="18" class="sign-status">{{goodsPost.signStatusName}}</div>
            </div>
          </div>
          <div nz-col nzSpan="8" *ngIf="goodsPost.signStatus ===2 || goodsPost.signStatus === 3">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">签收人：</div>
              <div nz-col nzSpan="18">{{goodsPost.signerName}}</div>
            </div>
          </div>
          <div nz-col nzSpan="8" *ngIf="goodsPost.signStatus ===2 || goodsPost.signStatus === 3">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">签收时间：</div>
              <div nz-col nzSpan="18">{{goodsPost.signTime | date:'yyyy-MM-dd HH:mm'}}</div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row">
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">发货企业：</div>
              <div nz-col nzSpan="18">{{goodsPost.consignCorpName}}</div>
            </div>
          </div>
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">发货网点：</div>
              <div nz-col nzSpan="18">{{goodsPost.consignBranchName}}</div>
            </div>
          </div>
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">发货人：</div>
              <div nz-col nzSpan="18">{{goodsPost.consignUserName}}
                <span *ngIf="goodsPost.consignUserPhone">({{goodsPost.consignUserPhone}})</span>
              </div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row">
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">行政区划：</div>
              <div nz-col nzSpan="18">{{goodsPost.consignAreaName}}</div>
            </div>
          </div>
          <div nz-col nzSpan="16">
            <div nz-row>
              <div nz-col nzSpan="3" class="label-item">发货地址：</div>
              <div nz-col nzSpan="21">{{goodsPost.consignAddress}}</div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row">
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">收货企业：</div>
              <div nz-col nzSpan="18">{{goodsPost.receiveCorpName}}</div>
            </div>
          </div>
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">收货网点：</div>
              <div nz-col nzSpan="18">{{goodsPost.receiveBranchName}}</div>
            </div>
          </div>
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">收货人：</div>
              <div nz-col nzSpan="18">{{goodsPost.receiverName}}
                <span *ngIf="goodsPost.receiverPhone">({{goodsPost.receiverPhone}})</span>
              </div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row">
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">行政区划：</div>
              <div nz-col nzSpan="18">{{goodsPost.receiveAreaName}}</div>
            </div>
          </div>
          <div nz-col nzSpan="16">
            <div nz-row>
              <div nz-col nzSpan="3" class="label-item">收货地址：</div>
              <div nz-col nzSpan="21">{{goodsPost.receiveAddress}}</div>
            </div>
          </div>
        </div>
        <nz-divider [nzDashed]="true"></nz-divider>
        <div nz-row class="div-row">
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">运输方式：</div>
              <div nz-col nzSpan="18">{{goodsPost.transportTypeName}}</div>
            </div>
          </div>
          <div nz-col nzSpan="8" *ngIf="goodsPost.transportType === 2">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">托运方式：</div>
              <div nz-col nzSpan="18">{{goodsPost.consignTypeName}}</div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row" *ngIf="goodsPost.transportType === 3">
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">快递公司：</div>
              <div nz-col nzSpan="18">{{goodsPost.expressCorpName}}</div>
            </div>
          </div>
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">快递单号：</div>
              <div nz-col nzSpan="18">{{goodsPost.expressNo}}</div>
            </div>
          </div>
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">快递类型：</div>
              <div nz-col nzSpan="18">{{goodsPost.expressTypeName}}</div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row">
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">总箱数：</div>
              <div nz-col nzSpan="18">{{goodsPost.boxNum}}</div>
            </div>
          </div>
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">发货时间：</div>
              <div nz-col nzSpan="18">{{goodsPost.consignTime | date: 'yyyy-MM-dd'}}</div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row">
          <div nz-col nzSpan="24">
            <div nz-row>
              <div nz-col nzSpan="2" class="label-item">工单号：</div>
              <div nz-col nzSpan="22">
                <p style="word-wrap:break-word;table-layout:fixed;word-break:break-all;"><span
                  *ngFor="let work of goodsPost.goodsPostWorkDtoList;let index = index;"><span
                  *ngIf="index > 0">,</span><a (click)="toWorkDetail(work.workId)">{{ work.workCode }}</a></span></p>
              </div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row">
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">付费方式：</div>
              <div nz-col nzSpan="18">{{goodsPost.payWayName}}</div>
            </div>
          </div>
          <div nz-col nzSpan="8">
            <div nz-row>
              <div nz-col nzSpan="6" class="label-item">邮寄费(元)：</div>
              <div nz-col nzSpan="18">{{goodsPost.postFee}}</div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row">
          <div nz-col nzSpan="24">
            <div nz-row>
              <div nz-col nzSpan="2" class="label-item">发货备注：</div>
              <div nz-col nzSpan="22">{{goodsPost.consignNote}}</div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row">
          <div nz-col nzSpan="24">
            <div nz-row>
              <div nz-col nzSpan="2" class="label-item">附件：</div>
              <div nz-col nzSpan="22">
                <nz-avatar *ngFor="let file of imgList;let i = index"
                           [nzShape]="'square'" [nzSize]="50"
                           style="margin-left: 10px;margin-bottom: 10px;"
                           [nzSrc]="showFileUrl + file.fileId"
                           pro-image-viewer
                           [images]="getImageUrls(imgList)"
                           [currentImgIndex]="i+1">
                </nz-avatar>
                <br *ngIf="imgList && imgList.length > 0"/>
                <a *ngFor="let file of notImgList" pro-down-file [httpUrl]="downFileUrl + file.fileId"
                   [fileName]="file.fileName" httpMethod="post"
                   style="margin-left: 10px;margin-bottom: 10px;">{{file.fileName}}<br/></a>
              </div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row" *ngIf="!ifCanSign">
          <div nz-col nzSpan="24">
            <div nz-row>
              <div nz-col nzSpan="2" class="label-item">收货备注：</div>
              <div nz-col nzSpan="22">{{goodsPost.receiveNote}}</div>
            </div>
          </div>
        </div>
        <div nz-row class="div-row" *ngIf="ifCanSign">
          <div nz-col nzSpan="24">
            <div nz-row>
              <div nz-col nzSpan="2" class="label-item">收货备注：</div>
              <div nz-col nzSpan="22">
              <textarea nz-input rows="3" [(ngModel)]="receiveNote"
                        placeholder="请输入收货备注"
                        style="width: 500px;"></textarea>
              </div>
            </div>
          </div>
        </div>
      </nz-card>
      <nz-page-header style="padding: 8px 16px; background-color: white;" [style.padding-bottom.px]="'8'">
        <nz-page-header-title>
          <div style="display: inline-block; float: left; background: #FF9F00;
    height: 20px; width: 5px; margin-right: 10px; margin-top: 6px;"></div>
          物品清单
        </nz-page-header-title>
      </nz-page-header>
      <nz-card [nzBordered]="false" [nzBodyStyle]="{'padding-top':'0'}">
        <nz-table #editRowTable
                  nzBordered
                  [nzShowPagination]="false"
                  [nzData]="goodsList">
          <thead>
          <tr>
            <th *ngIf="ifCanSign"
                nzShowCheckbox="true"
                [nzChecked]="checkedAll" [nzIndeterminate]="indeterminate"
                (nzCheckedChange)="onAllChecked($event)"></th>
            <th nzWidth="50px">序号</th>
            <th nzWidth="250px">物品名称</th>
            <th nzWidth="150px">序列号</th>
            <th nzWidth="80px">数量</th>
            <th nzWidth="80px">分箱号</th>
            <th nzWidth="250px">附件</th>
            <th nzWidth="70px">已签收</th>
            <th nzWidth="100px">签收人</th>
            <th nzWidth="150px">签收时间</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let data of editRowTable.data; let index = index;">
            <td *ngIf="ifCanSign"
                [nzShowCheckbox]="!data.disabled"
                [nzChecked]="setOfCheckedId.has(data.id)"
                (nzCheckedChange)="onItemChecked(data.id, $event)"></td>
            <td>{{ index + 1 }}</td>
            <td>{{ data.goodsName }}</td>
            <td>{{ data.sn }}</td>
            <td>{{ data.quantity }}</td>
            <td>{{ data.subBoxNum }}</td>
            <td nzAlign="left">
              <nz-avatar *ngFor="let file of data.imgList;let i = index"
                         [nzShape]="'square'" [nzSize]="50"
                         style="margin-left: 10px;margin-bottom: 10px;"
                         [nzSrc]="showFileUrl + file.fileId"
                         pro-image-viewer
                         [images]="getImageUrls(data.imgList)"
                         [currentImgIndex]="i+1">
              </nz-avatar>
              <br *ngIf="data.imgList && data.imgList.length > 0"/>
              <a *ngFor="let file of data.notImgList" pro-down-file [httpUrl]="downFileUrl + file.fileId"
                 [fileName]="file.fileName" httpMethod="post"
                 style="margin-left: 10px;margin-bottom: 10px;">{{file.fileName}}<br/></a>
            </td>
            <td>
              <span *ngIf="data.signed === 'Y'">是</span>
              <span *ngIf="data.signed !== 'Y'">否</span>
            </td>
            <td>{{ data.signerName }}</td>
            <td>{{ data.signTime | date:'yyyy-MM-dd HH:mm' }}</td>
          </tr>
          </tbody>
        </nz-table>
        <div style="margin-top: 32px;text-align: center;">
          <button type="button" nz-button (click)="goBack()">返回</button>&nbsp;&nbsp;
          <button type="button" nz-button nzType="primary" (click)="signGoods()"
                  *ngIf="ifCanSign">签收
          </button>
        </div>
      </nz-card>
    </nz-layout>
  </nz-spin>
</nz-layout>
