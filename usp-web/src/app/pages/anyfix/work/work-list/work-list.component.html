<my-pro-page-header-wrapper>
  <nz-card [nzBordered]="false">
    <!-----------------------------------工单列表-------------------------------------------------->
    <div style="float: left; margin-right: 200px; margin-bottom: 16px;">
        <a (click)="getAllWork()" style="font-size: 14px;font-weight: 400;"
           [ngStyle]="changeColorBig(0)">全部({{showWorkStatusCount(workStatusCountList.ALL_WORK)}})</a>
        <nz-divider nzType="vertical" nzDashed></nz-divider>

        <a (click)="getAttentionWork()" style="font-size: 14px;font-weight: 400;"
           [acl]="{ability: [aclRight.WORK_ATTENTION]}"
         [ngStyle]="changeColorBig(2)">已关注({{showWorkStatusCount(attentionWorkCount)}})</a>
        <nz-divider nzType="vertical" nzDashed [acl]="{ability: [aclRight.WORK_ATTENTION]}"></nz-divider>

        <a (click)="getSupportWork()" style="font-size: 14px;font-weight: 400;"
           [acl]="{ability: [aclRight.WORK_SUPPORT]}"
           [ngStyle]="changeColorBig(3)">技术支持({{showWorkStatusCount(supportWorkCount)}})</a>
        <nz-divider nzType="vertical" nzDashed [acl]="{ability: [aclRight.WORK_SUPPORT]}"></nz-divider>

        <a (click)="changeTag(anyfixService.TO_DISTRIBUTE)" style="font-size: 14px;font-weight: 400;"
           *ngIf="isDemanderCorp"
           [ngStyle]="changeColorBig(anyfixService.TO_DISTRIBUTE)">待提单({{showWorkStatusCount(workStatusCountList.TO_DISTRIBUTE)}})</a>
        <nz-divider nzType="vertical" nzDashed *ngIf="isDemanderCorp"></nz-divider>
        <a (click)="changeTag(anyfixService.RETURNED)" style="font-size: 14px;font-weight: 400;"
           *ngIf="isDemanderCorp"
           [ngStyle]="changeColorBig(anyfixService.RETURNED)">已退单({{showWorkStatusCount(workStatusCountList.RETURNED)}})</a>
        <nz-divider nzType="vertical" nzDashed *ngIf="isDemanderCorp"></nz-divider>
        <a (click)="getHandledWork()" style="font-size: 14px;font-weight: 400;"
           [ngStyle]="changeColorBig(1)">处理中({{showWorkStatusCount(workStatusCountList.HANDLED_WORK)}})</a>
        <a (click)="changeTag(anyfixService.TO_HANDLE)" style="font-size: 11px;margin-left: 12px;"
          [ngStyle]="changeColorSmall(anyfixService.TO_HANDLE)">待分配({{showWorkStatusCount(workStatusCountList.TO_HANDLE)}})</a>
        <a (click)="changeTag(anyfixService.TO_ASSIGN)" style="font-size: 11px;margin-left: 12px;"
           [ngStyle]="changeColorSmall(anyfixService.TO_ASSIGN )">待派单({{showWorkStatusCount(workStatusCountList.TO_ASSIGN)}})</a>
        <a (click)="changeTag(anyfixService.TO_CLAIM)" style="font-size: 11px;margin-left: 12px;"
           [ngStyle]="changeColorSmall(anyfixService.TO_CLAIM )">待接单({{showWorkStatusCount(workStatusCountList.TO_CLAIM)}})</a>
        <a (click)="changeTag(anyfixService.TO_SIGN)" style="fo-nt-size: 11px;margin-left: 12px;"
           [ngStyle]="changeColorSmall(anyfixService.TO_SIGN )">待签到({{showWorkStatusCount(workStatusCountList.TO_SIGN)}})</a>
        <a (click)="changeTag(anyfixService.IN_SERVICE)" style="font-size: 11px;margin-left: 12px;"
           [ngStyle]="changeColorSmall(anyfixService.IN_SERVICE)">服务中({{showWorkStatusCount(workStatusCountList.IN_SERVICE)}})</a>
      <!--<i nz-icon nzType="plus-circle" nzTheme="outline" [acl]="{ability: [aclRight.WORK_ADD]}" class="icon-add"
         (click)="addWork()" nz-tooltip
         nzTooltipTitle="新建"></i>-->
        <!--<i nz-icon nzType="anyfix:filtrate" nzTheme="outline" class="img-filtrate" (click)="openDrawer()" nz-tooltip
           nzTooltipTitle="筛选"></i>-->
    </div>
    <div>
      <button nz-button  class="icon-add" nzShape="round"  (click)="addWork()" [acl]="{ability: [aclRight.WORK_ADD]}">新建</button>
      <button nz-button  class="img-filtrate" nzShape="round"  (click)="openDrawer()">筛选</button>
      <button nz-button nzNoAnimation nz-dropdown [nzDropdownMenu]="menu"
              class="more-button">
        <img class="menu-img" src="assets/drop-menu-theme.svg" style="margin-top: -2px; margin-left: -8px;">
      </button>
      <nz-dropdown-menu #menu="nzDropdownMenu">
        <ul nz-menu>
          <li nz-menu-item (click)="openCustomList()" >自定义列</li>
          <li nz-menu-item (click)="importWork()" [acl]="{ability: [aclRight.WORK_ADD]}" >导入建单</li>
          <li> <button nz-menu-item
                       style="border: none;outline: none"
                       pro-down-file
                       [acl]="{ability: [aclRight.WORK_EXPORT]}"
                       httpMethod="post"
                       [httpUrl]="'/api/anyfix/work-excel/export'"
                       [msg] ="'正在导出工单...'"
                       [fileNum] ="this.workNum"
                       [httpBody]="getParams()" >导出工单</button></li>
        </ul>
      </nz-dropdown-menu>
    </div>
    <ng-template #totalTemplate let-total> 共 {{ total }} 条 </ng-template>
    <nz-table nzShowSizeChanger [nzPageSizeOptions]="userService.pageSizeOptions"
              nzBordered
              style="padding-top: 20px;"
              [nzFrontPagination]="false"
              [nzData]="workList"
              [nzLoading]="loading"
              [nzTotal]="page.total"
              [(nzPageIndex)]="page.pageNum"
              [(nzPageSize)]="page.pageSize"
              [nzShowTotal]="totalTemplate"
              (nzPageIndexChange)="queryWork(false)"
              (nzPageSizeChange)="queryWork(true)"
              [nzScroll]="{ x: totalWidth + 'px' }"
    >
      <thead>
      <tr >
        <th nzWidth="50px" nzLeft="0px">序号</th>
        <th nzWidth="100px" nzLeft="50px">工单状态</th>
        <th nzWidth="150px" nzLeft="150px">工单编号</th>
        <th nzWidth="150px">委托单号</th>
        <ng-container *ngFor="let item of customTileList">
          <th  *ngIf="item.checked" [nzWidth]="item.width + 'px'">{{item.title}}</th>
        </ng-container>
      </tr>
      </thead>
      <tbody >
      <tr *ngFor="let data of workList;let i = index;" (dblclick)="toWorkDetail(data.workId)"
          (click)="clickRow(data.workId)" [ngStyle]="rowColor(data.workId)">
        <td nzLeft="0px" [ngStyle]="rowColor(data.workId)">{{page.getNo(i)}}</td>
        <td nzLeft="50px" [ngStyle]="rowColor(data.workId)">
          <button nz-button class="button-status" [ngStyle]="data.buttonColor" (click)="toWorkDetail(data.workId)">{{ data.workStatusName}}</button>
        </td>
        <td nzLeft="150px" [ngStyle]="rowColor(data.workId)"><a (click)="toWorkDetail(data.workId)">{{data.workCode}}</a></td>
        <td nzBreakWord>{{data.checkWorkCode}}</td>
        <td *ngIf="showRowData.provinceName">{{data.provinceName}}</td>
        <td *ngIf="showRowData.cityName">{{data.cityName}}</td>
        <td *ngIf="showRowData.districtName">{{data.districtName}}</td>
        <td *ngIf="showRowData.customCorpName" >{{ data.customCorpName }}</td>
        <td *ngIf="showRowData.smallClassName">{{data.smallClassName}}</td>
        <td *ngIf="showRowData.serial">{{data.serial}}</td>
        <td *ngIf="showRowData.brandName">{{data.brandName}}</td>
        <td *ngIf="showRowData.modelName">{{data.modelName}}</td>
        <td *ngIf="showRowData.specificationName ">{{data.specificationName}}</td>
        <td *ngIf="showRowData.sourceName">{{ data.sourceName }}</td>
        <td *ngIf="showRowData.workTypeName">{{ data.workTypeName }}</td>
        <td *ngIf="showRowData.creatorName ">{{data.creatorName}}</td>
        <td *ngIf="showRowData.createTime">{{ data.createTime | date:'yyyy-MM-dd HH:mm'}}</td>
        <td *ngIf="showRowData.demanderCorpName">{{data.demanderCorpName}}</td>
        <td *ngIf="showRowData.deviceBranchName">{{data.deviceBranchName}}</td>
        <td *ngIf="showRowData.serviceCorpName">{{data.serviceCorpName}}</td>
        <td *ngIf="showRowData.serviceBranchName">{{data.serviceBranchName}}</td>
        <td *ngIf="showRowData.engineerName ">{{data.engineerName}}</td>
        <td *ngIf="showRowData.togetherEngineers ">{{data.togetherEngineers}}</td>
        <td *ngIf="showRowData.helpNames ">{{data.helpNames}}</td>
        <td *ngIf="showRowData.bookTimeEnd">{{data.bookTimeEnd | date:'yyyy-MM-dd HH:mm'}}</td>
        <td *ngIf="showRowData.dispatchTime">{{ data.dispatchTime | date:'yyyy-MM-dd HH:mm'}}</td>
        <td *ngIf="showRowData.endTime">{{data.endTime | date:'yyyy-MM-dd HH:mm'}}</td>
        <td *ngIf="showRowData.serviceModeName">{{data.serviceModeName}}</td>
        <td *ngIf="showRowData.serviceRequest">{{data.serviceRequest}}</td>
        <td *ngIf="showRowData.contactName ">{{data.contactName}}</td>
        <td *ngIf="showRowData.contactPhone ">{{data.contactPhone}}</td>
        <td *ngIf="showRowData.address ">{{data.address}}</td>
        <td *ngIf="showRowData.warrantyModeName ">{{data.warrantyModeName}}</td>
        <td *ngIf="showRowData.faultTypeName ">{{data.faultTypeName}}</td>
        <td *ngIf="showRowData.acceptTime">{{data.acceptTime | date:'yyyy-MM-dd HH:mm'}}</td>
        <td *ngIf="showRowData.goTime">{{data.goTime | date:'yyyy-MM-dd HH:mm'}}</td>
        <td *ngIf="showRowData.signTime">{{data.signTime | date:'yyyy-MM-dd HH:mm'}}</td>
      </tr>
      </tbody>
    </nz-table>
  </nz-card>
  <!-----------------------------------工单列表查询条件抽屉-------------------------------------------------->
  <ng-template #filterTitle>
    <img src="assets/go-back.svg" (click)="closeDrawer()" style="padding-right: 20px;">
    <span style="font-size: 16px;font-weight: bold;">工单筛选</span>
  </ng-template>

  <nz-drawer [nzTitle]="filterTitle" [nzVisible]="visible" [nzWidth]="900" [nzClosable]="false" (nzOnClose)="closeDrawer()"
             [nzBodyStyle]="{ height: 'calc(100% - 55px)', overflow: 'auto', 'padding-bottom': '53px' }">
    <work-list-filter [allChecked]="allChecked"
                      [checkOptionsOne]="checkOptionsOne"
                      [params]="params"
                      [searchForm]="searchForm"
                      (searchFormData)="searchFormDataChange($event)"></work-list-filter>
    <div class="footer">
      <button nz-button (click)="clearDrawer()" class="ant-btn" style="margin-right: 10px;">清空筛选
      </button>
      <button (click)="closeDrawer();queryWork(true);" nz-button nzType="primary">确定</button>
    </div>
  </nz-drawer>

</my-pro-page-header-wrapper>





