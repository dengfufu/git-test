<pro-basic-layout [logo]="settings.logo"
                  [title]="titleTemplate"
                  [navTheme]="settings.navTheme"
                  [fixSiderbar]="settings.fixSiderbar"
                  [fixedHeader]="settings.fixedHeader"
                  [autoHideHeader]="settings.autoHideHeader"
                  [contentWidth]="settings.contentWidth"
                  [layout]="settings.layout"
                  [mode]="settings.mode"
                  [menuData]="menuData"
                  [siderWidth]="settings.siderWidth"
                  [rightContentRender]="rightContentRender"
                  [footerRender]="false">
  <router-outlet></router-outlet>
</pro-basic-layout>

<ng-template #rightContentRender>
  <pro-right-content [theme]="settings.navTheme" [layout]="settings.layout"></pro-right-content>
</ng-template>

<ng-template #titleTemplate>
  <div class="pro-layout-title">
    <img src="assets/anyfix.svg" width="51px" height="21px">
  </div>
</ng-template>

<nz-modal [(nzVisible)]="shouldShowModal"
          nzTitle="设置密码"
          (nzOnCancel)="shouldShowModal=false"
          (nzOnOk)="toSetPassword()"
          [nzOkDisabled]="changePasswordForm.invalid"
          [nzOkLoading]="isOkLoading">
  <nz-spin [nzSpinning]="changPasswordSpinning" >
    <form nz-form  nzLayout="vertical" [formGroup]="changePasswordForm" >
      <nz-form-item>
        <nz-form-control>
          <nz-row [nzGutter]="8">
            <nz-col [nzSpan]="16">
              <nz-input-group nzSize="large">
                <input nz-input formControlName="phone" [placeholder]="'验证码'" [disabled]="true"/>
              </nz-input-group>

            </nz-col>
            <nz-col [nzSpan]="8">
              <button
                type="button"
                nz-button
                nzSize="large"
                (click)="getCaptcha('password')"
                [disabled]="count"
                nzBlock
                [nzLoading]="isSmsLoading">
                {{ count ? count + 's' : '获取验证码' }}
              </button>
            </nz-col>
          </nz-row>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-control>
          <nz-form-label>验证码</nz-form-label>
          <nz-input-group nzSize="large" nzAddonBeforeIcon="smsCode">
            <input nz-input formControlName="smsCode" [placeholder]="'6位数字验证码'"/>
          </nz-input-group>
          <nz-form-explain *ngIf="smsCode.dirty && smsCode.errors">
            <ng-container *ngIf="smsCode.errors.required">请输入验证码！</ng-container>
            <ng-container *ngIf="smsCode.errors.pattern">验证码格式错误！</ng-container>
          </nz-form-explain>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>新密码</nz-form-label>
        <nz-form-control nzHasFeedback [nzErrorTip]="newPasswordErrorTpl">
          <input nz-input formControlName="newPassword" type="password" placeholder="6~20位字母、数字或者特殊字符"/>
        </nz-form-control>
        <ng-template #newPasswordErrorTpl let-control>
          <ng-container *ngIf="control.hasError('required')">
            请输入新密码！
          </ng-container>
          <ng-container *ngIf="control.hasError('pattern')">
            6~20位字母、数字或者特殊字符！
          </ng-container>
        </ng-template>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label>确认新密码</nz-form-label>
        <nz-form-control nzHasFeedback  [nzErrorTip]="confirmErrorTpl">
          <input nz-input formControlName="confirm" type="password" placeholder="6~20位字母、数字或者特殊字符"/>
          <ng-template #confirmErrorTpl let-control>
            <ng-container *ngIf="control.hasError('match')">
              两次输入的密码不匹配！
            </ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
    </form>
  </nz-spin>
</nz-modal>
